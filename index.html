<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <title>COVID Rapid-test Simulation</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, shrink-to-fit=no">
    <meta name="Referrer" content="origin">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="canonical" href="">
    <meta name="theme-color" content="#ffffff">

    <!-- <link rel="stylesheet" href="https://bootflat.github.io/bootflat/css/bootflat.css"> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="./styles.css" />

    <meta name="description" content="">
    <meta name="keywords" content="COVID,Rapid Testing">

    <!-- Facebook -->
    <meta property="og:app_id" content="">
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">

    <!-- Twitter -->
    <meta name="twitter:card" content="">
    <meta name="twitter:site" content="">
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- LinkedIn -->
    <meta property="og:title" content="">
    <meta property="og:image" content="">
    <meta property="og:description" content="">
    <meta property="og:url" content="">

</head>
<body>
    <div class="container-md">
        <div class="block sm">
            <h1>Simulation testing.</h1>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>
        <div class="block">
            <!-- <canvas id="Simulation1" class="simulation"></canvas> -->
            <div id="Simulation1" class="simulation"></div>
        </div>
        <div class="block">
            <!-- Create a div where the graph will take place -->
            <canvas id="Simulation1Chart"></canvas>
        </div>
        <div class="block">
            <!-- Create a div where the graph will take place -->
            <div id="Simulation2" class="simulation"></div>
        </div>
    </div>
</body>

<!-- External -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" type="text/javascript"></script>
<script src="https://d3js.org/d3.v3.js" type="text/javascript"></script>
<script src="https://unpkg.com/geometric@2/build/geometric.min.js"></script>

<!-- Main COVID simulation -->
<script src="./lib/simulation.js" type="text/javascript"></script>

<!-- Visualizations -->
<script src="./visuals/common.js" type="text/javascript"></script>
<script src="./visuals/svgAnimation.js" type="text/javascript"></script>
<script src="./visuals/canvasAnimation.js" type="text/javascript"></script>
<script>
    window.onload = function () {
        // Starts the first visualization
        // const svg = Initialize('Simulation2');
        // StartStopVisual();

        // Starts canvas animation
        startCanvasAnimation();

        // set the dimensions and margins of the graph
        let margin = { top: 10, right: 30, bottom: 30, left: 50 };
        let width  = 460 - margin.left - margin.right;
        let height = 400 - margin.top - margin.bottom;
        
        // Add SVG element
        // const Chart = d3.select('#Simulation1Chart')
        //     .append('svg')
        //     .attr('width', width + margin.left + margin.right)
        //     .attr('height', height + margin.top + margin.bottom)
        //     .append('g')
        //     .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');
        
        // Process data events...
        // d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/3_TwoNumOrdered_comma.csv",
        
        //     // When reading the csv, I must format variables:
        //     function (d){
        //         return { date : d3.timeParse("%Y-%m-%d")(d.date), value : d.value }
        //     },
        
        // });

        // new Chart('Simulation1Chart', {
        //     type: 'line',
        //     data: {
        //         // labels: generateLabels(),
        //         datasets: [{
        //             backgroundColor: '#ddd', // utils.transparentize(presets.red),
        //             borderColor: '#ccc', // presets.red,
        //             data: [ 100, 110, 112], // generateData(),
        //             label: 'Dataset',
        //             fill: true
        //         }],
        //         // labels: ['January', 'February', 'March', 'April']
        //     },
        //     options: {
        //         maintainAspectRatio: false,
        //         spanGaps: false,
        //         elements: {
        //             line: {
        //                 tension: 0.000001
        //             }
        //         },
        //         plugins: {
        //             filler: {
        //                 propagate: false
        //             },
        //             title: {
        //                 // text: 'fill: ' + boundary,
        //                 display: true
        //             }
        //         },
        //         scales: {
        //             yAxes: [{
        //                 ticks: {
        //                     suggestedMin: 0,
        //                     suggestedMax: 100
        //                 }
        //             }],
        //             xAxes: [{
        //                 ticks: {
        //                     max: 1000,
        //                     min: 0,
        //                     stepSize: 10
        //                 }
        //             }]
        //         }
        //         // scales: {
        //         //     x: {
        //         //         ticks: {
        //         //             autoSkip: false,
        //         //             maxRotation: 0
        //         //         }
        //         //     }
        //         // }
        //     }
        // });

        // Add X axis --> it is a date format
        // let x = d3.scaleTime()
        //     .domain(d3.extent(data, function(d) { return d.date; }))
        //     .range([ 0, 100 ]);
        
        // svg.append("g")
        //     .attr("transform", "translate(0," + height + ")")
        //     .call(d3.axisBottom(x));
    
        // // Add Y axis
        // let y = d3.scaleLinear()
        //     .domain([0, d3.max(data, function(d) { return +d.value; })])
        //     .range([ height, 0 ]);
        // svg.append("g")
        //     .call(d3.axisLeft(y));

        // Now I can use this dataset:
        function processDataPoint(current) { 
            console.log("Count: ", current.tickCnt, " -- ",
                current.countof(ACTOR_STATUS.SUSCEPTIBLE),
                current.countof(ACTOR_STATUS.INFECTIOUS),
                current.countof(ACTOR_STATUS.RECOVERED),
                current.countof(ACTOR_STATUS.DECEASED),
            );       
            // Add the area
            // svg.append("path")
            //     .datum(data)
            //     .attr("fill", "#cce5df")
            //     .attr("stroke", "#69b3a2")
            //     .attr("stroke-width", 1.5)
            //     .attr("d", d3.area()
            //         .x(function(d) { return x(d.date) })
            //         .y0(y(0))
            //         .y1(function(d) { return y(d.value) })
            //     );

            // Update Charts.js chart
            // myChart.update({ duration: 0 });
        }

        console.log('Starting simulation...');
        const parameters = new SimulationParameters();
        console.log('Population size:', parameters.populationSize);
        const simulation = new Simulation(parameters);

        for (let t = 0; t < 1000; t++) {
            simulation.tick();
            processDataPoint(simulation);
            // simulation.update();
        }

        console.log("End Simulation");
    };
</script>

</html>
