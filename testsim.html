<!DOCTYPE html>
<html>
<script src="./lib/simulation.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.bundle.min.js"></script>
<script src="./lib/linechart.js"></script>
<div style="width: 100%; height: 100%">
    <canvas id="line_chart"></canvas>
</div>
<div>
   Starting parameters <br/>
   Population <input id=population_size type=text value=10000 /><br/>
   Initial Infected Pct <input type=text id=initial_infected value=0.5 /><br/>
   Self-isolating symptomatic (with or without test) <input type=text id=self_isolation_rate value=0.1><br />
   Self-isolating days  <input type=text id=positive_test_isolation_interval value=14><br />
   Daily interactions (avg) <input type=text id=num_interactions value=3.0><br />
   Daily interactions (STD) <input type=text id=num_interactions_std value=0.02><br />

   Rapid Testing Parameters <br />
   Testing interval (in days) <input type=text id=testing_interval_days value=3 /><br/>
   Percent of population testing <input type=text id=testing_rate value=50 /><br/>
   False Positive percent <input type=text id=false_positive value=0.01 /><br/>
   False Negative percent <input type=text id=false_negative value=0.02 /><br/>

   Disease Parameters <br />
   Testing interval (in days) <input type=text id=testing_interval_days value=3 /><br/>
   Percent of population testing <input type=text id=testing_rate value=50 /><br/>
   False Positive percent <input type=text id=false_positive value=0.01 /><br/>
   False Negative percent <input type=text id=false_negative value=0.02 /><br/>


   <button id="run_simulation">Run Simulation</button>
</div>

<script>
    function donothing() {
    }

    console.log("Start");

    document.getElementById('run_simulation').addEventListener('click', function() {
        var parameters = new SimulationParameters();
        // Population Parameters
        parameters.populationSize = parseInt(document.getElementById('population_size').value);
        parameters.startingInfectionRate = parseFloat(document.getElementById('initial_infected').value);
        parameters.positiveTestIsolationInterval = parseFloat(document.getElementById('positive_test_isolation_interval').value);
        parameters.numInteractions = parseFloat(document.getElementById('num_interactions').value);
        parameters.numInteractionsSTD = parseFloat(document.getElementById('num_interactions_std').value);

        // Testing Parameters
        parameters.testingInterval = parseFloat(document.getElementById('testing_interval_days').value);
        parameters.testingRate = parseFloat(document.getElementById('testing_rate').value);
        parameters.falsePositiveRate = parseFloat(document.getElementById('false_positive').value);
        parameters.falseNegative = parseFloat(document.getElementById('false_negative').value);

        // Disease Parameters
        parameters.daysToContagious = parseFloat(document.getElementById('days_to_contagious').value);
        parameters.daysToDetectable = parseFloat(document.getElementById('days_to_detectable').value);
        parameters.daysToSymptoms = parseFloat(document.getElementById('days_to_symptoms').value);
        parameters.daysToRecovery = parseFloat(document.getElementById('days_to_recovery').value);
        parameters.mortalityRate = parseFloat(document.getElementById('mortality_rate').value);
        parameters.asymptomaticRate = parseFloat(document.getElementById('asymptomatic_rate').value);
        parameters.recoveredResistance = parseFloat(document.getElementById('recovered_resistance').value);

        console.log(parameters.populationSize);
        console.log(parameters.startingInfectionRate);
        console.log(parameters.testingInterval);
        console.log(parameters.testingRate);
        console.log(parameters.populationSize);
        console.log(parameters.populationSize);
        console.log(parameters.populationSize);
        console.log(parameters.populationSize);
        console.log(parameters.populationSize);
        console.log(parameters.populationSize);

    });

    function runSimulation(parameters) {
        var simulation = new Simulation(parameters);
        let running = true;

        //Initialize chart
        var ctx = document.getElementById("line_chart").getContext("2d");

        chart_config = initChart(500);
        var lineChart = new Chart(ctx, chart_config);

        for (t = 0; t < 500; t++) {
            simulation.tick();

            console.log(simulation.tickCnt,
                simulation.totals.susceptible,
                simulation.totals.infected,
                simulation.totals.recovered,
                simulation.totals.deceased,
                simulation.totals.testsConducted,
                simulation.totals.daysLost,
            )
            //simulation.update();

            setDayData(chart_config, t,    
                simulation.totals.deceased/simulation.config.populationSize * 100.0,
                simulation.totals.infected/simulation.config.populationSize * 100.0,
                simulation.totals.recovered/simulation.config.populationSize * 100.0,
                simulation.totals.susceptible/simulation.config.populationSize * 100.0,
                );
            
                lineChart.update();
        }

        console.log("End");
    }
</script>
</html>

  