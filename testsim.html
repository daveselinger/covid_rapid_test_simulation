<!DOCTYPE html>
<html>
<script src="./lib/simulation.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.bundle.min.js"></script>
<script src="./lib/linechart.js"></script>
<div style="width: 100%; height: 100%">
    <canvas id="line_chart"></canvas>
</div>
<div>
   Population <input id=population_size type=text value=10000 />
   Initial Infected Pct <input type=text id=initial_infected value=0.5 />

   Test Parameters <br />
   Testing interval (in days) <input type=text id=testing_interval_days value=3 />
   Percent of population testing <input type=text id=testing_rate value=50 />
   <button id="run_simulation">Run Simulation</button>
</div>

<script>
    function donothing() {
    }

    console.log("Start");

    document.getElementById('run_simulation').addEventListener('click', function() {
        var parameters = new SimulationParameters();
        parameters.populationSize = parseInt(document.getElementById('population_size').value);
        parameters.startingInfectionRate = parseFloat(document.getElementById('initial_infected').value);
        parameters.testingInterval = parseFloat(document.getElementById('testing_interval_days').value);
        parameters.testingRate = parseFloat(document.getElementById('testing_rate').value);

        console.log(parameters.populationSize);
        console.log(parameters.startingInfectionRate);
        console.log(parameters.testingInterval);
        console.log(parameters.testingRate);
        console.log(parameters.populationSize);
        console.log(parameters.populationSize);
        console.log(parameters.populationSize);
        console.log(parameters.populationSize);
        console.log(parameters.populationSize);
        console.log(parameters.populationSize);

    });

    function runSimulation(parameters) {
        var simulation = new Simulation(parameters);
        let running = true;

        //Initialize chart
        var ctx = document.getElementById("line_chart").getContext("2d");

        chart_config = initChart(500);
        var lineChart = new Chart(ctx, chart_config);

        for (t = 0; t < 500; t++) {
            simulation.tick();

            console.log(simulation.tickCnt,
                simulation.totals.susceptible,
                simulation.totals.infected,
                simulation.totals.recovered,
                simulation.totals.deceased,
                simulation.totals.testsConducted,
                simulation.totals.daysLost,
            )
            //simulation.update();

            setDayData(chart_config, t,    
                simulation.totals.deceased/simulation.config.populationSize * 100.0,
                simulation.totals.infected/simulation.config.populationSize * 100.0,
                simulation.totals.recovered/simulation.config.populationSize * 100.0,
                simulation.totals.susceptible/simulation.config.populationSize * 100.0,
                );
            
                lineChart.update();
        }

        console.log("End");
    }
</script>
</html>

  